!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.geojsonvt=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b,c,d,g,h){c/=b,d/=b;for(var i=[],j=0;j<a.length;j++){var n,o,k=a[j],l=k.geometry,m=k.type;if(k.min){if(n=k.min[g],o=k.max[g],n>=c&&o<=d){i.push(k);continue}if(n>d||o<c)continue}var p=1===m?e(l,c,d,g):f(l,c,d,g,h,3===m);p.length&&i.push({geometry:p,type:m,tags:a[j].tags||null})}return i.length?i:null}function e(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g[d];h>=b&&h<=c&&e.push(g)}return e}function f(a,b,c,d,e,f){for(var h=[],i=0;i<a.length;i++){var q,r,j=0,k=0,l=null,m=a[i],n=m.area,o=m.dist,p=m.length,s=[];for(r=0;r<p-1;r++)q=l||m[r],l=m[r+1],j=k||q[d],k=l[d],j<b?k>c?(s.push(e(q,l,b),e(q,l,c)),f||(s=g(h,s,n,o))):k>=b&&s.push(e(q,l,b)):j>c?k<b?(s.push(e(q,l,c),e(q,l,b)),f||(s=g(h,s,n,o))):k<=c&&s.push(e(q,l,c)):(s.push(q),k<b?(s.push(e(q,l,b)),f||(s=g(h,s,n,o))):k>c&&(s.push(e(q,l,c)),f||(s=g(h,s,n,o))));q=m[p-1],j=q[d],j>=b&&j<=c&&s.push(q),f&&s[0]!==s[s.length-1]&&s.push(s[0]),g(h,s,n,o)}return h}function g(a,b,c,d){return b.length&&(b.area=c,b.dist=d,a.push(b)),[]}b.exports=d},{}],2:[function(a,b,c){"use strict";function e(a,b){var c=[];if("FeatureCollection"===a.type)for(var d=0;d<a.features.length;d++)f(c,a.features[d],b);else"Feature"===a.type?f(c,a,b):f(c,{geometry:a},b);return c}function f(a,b,c){var l,m,n,d=b.geometry,e=d.type,j=d.coordinates,k=b.properties;if("Point"===e)a.push(g(k,1,[i(j)]));else if("MultiPoint"===e)a.push(g(k,1,h(j)));else if("LineString"===e)a.push(g(k,2,[h(j,c)]));else if("MultiLineString"===e||"Polygon"===e){for(n=[],l=0;l<j.length;l++)n.push(h(j[l],c));a.push(g(k,"Polygon"===e?3:2,n))}else if("MultiPolygon"===e){for(n=[],l=0;l<j.length;l++)for(m=0;m<j[l].length;m++)n.push(h(j[l][m],c));a.push(g(k,3,n))}else if("GeometryCollection"===e)for(l=0;l<d.geometries.length;l++)f(a,{geometry:d.geometries[l],properties:k},c);else console.warn("Unsupported GeoJSON type: "+d.type)}function g(a,b,c){var d={geometry:c,type:b,tags:a||null,min:[1,1],max:[0,0]};return k(d),d}function h(a,b){for(var c=[],e=0;e<a.length;e++)c.push(i(a[e]));return b&&(d(c,b),j(c)),c}function i(a){var b=Math.sin(a[1]*Math.PI/180);return[a[0]/360+.5,.5-.25*Math.log((1+b)/(1-b))/Math.PI,0]}function j(a){for(var e,f,b=0,c=0,d=0;d<a.length-1;d++)e=f||a[d],f=a[d+1],b+=e[0]*f[1]-f[0]*e[1],c+=Math.abs(f[0]-e[0])+Math.abs(f[1]-e[1]);a.area=Math.abs(b/2),a.dist=c}function k(a){var b=a.geometry,c=a.min,d=a.max;if(1===a.type)l(c,d,b);else for(var e=0;e<b.length;e++)l(c,d,b[e]);return a}function l(a,b,c){for(var e,d=0;d<c.length;d++)e=c[d],a[0]=Math.min(e[0],a[0]),b[0]=Math.max(e[0],b[0]),a[1]=Math.min(e[1],a[1]),b[1]=Math.max(e[1],b[1])}b.exports=e;var d=a("./simplify")},{"./simplify":4}],3:[function(a,b,c){"use strict";function g(a,b){return new h(a,b)}function h(a,b){b=this.options=o(Object.create(this.options),b);var c=b.debug;c&&console.time("preprocess data");var e=1<<b.maxZoom,f=d(a,b.tolerance/(e*b.extent));this.tiles={},c&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),this.splitTile(f,0,0,0),c&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function i(a,b){if(!a||a.transformed)return a;var f,g,h,c=a.z2,d=a.x,e=a.y;for(f=0;f<a.features.length;f++){var i=a.features[f],k=i.geometry;if(1===i.type)for(g=0;g<k.length;g++)k[g]=j(k[g],b,c,d,e);else for(g=0;g<k.length;g++){var m=k[g];for(h=0;h<m.length;h++)m[h]=j(m[h],b,c,d,e)}}return a.transformed=!0,a}function j(a,b,c,d,e){return[Math.round(b*(a[0]*c-d)),Math.round(b*(a[1]*c-e))]}function k(a,b,c){if(1!==a.length)return!1;var d=a[0];if(3!==d.type||d.geometry.length>1)return!1;for(var e=0;e<d.geometry[0].length;e++){var f=d.geometry[0][e];if(f[0]!==-c&&f[0]!==b+c||f[1]!==-c&&f[1]!==b+c)return!1}return!0}function l(a,b,c){return 32*((1<<a)*c+b)+a}function m(a,b,c){return[c,(c-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function n(a,b,c){return[(c-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],c,1]}function o(a,b){for(var c in b)a[c]=b[c];return a}b.exports=g;var d=a("./convert"),e=a("./clip"),f=a("./tile");h.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},h.prototype.splitTile=function(a,b,c,d,g,h,i){for(var j=[a,b,c,d],o=this.options,p=o.debug,q=o.extent,r=o.buffer;j.length;){a=j.shift(),b=j.shift(),c=j.shift(),d=j.shift();var s=1<<b,t=l(b,c,d),u=this.tiles[t],v=b===o.maxZoom?0:o.tolerance/(s*q);if(!u&&(p>1&&console.time("creation"),u=this.tiles[t]=f(a,s,c,d,v,b===o.maxZoom),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,c,d,u.numFeatures,u.numPoints,u.numSimplified),console.timeEnd("creation"));var w="z"+b;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(u.source=a,!k(u.features,q,r)){if(g){if(b===o.maxZoom||b===g)continue;var x=1<<g-b;if(c!==Math.floor(h/x)&&d!==Math.floor(i/x))continue}else if(b===o.indexMaxZoom||u.numPoints<=o.indexMaxPoints)continue;u.source=null,p>1&&console.time("clipping");var C,D,E,F,G,H,y=.5*r/q,z=.5-y,A=.5+y,B=1+y;C=D=E=F=null,G=e(a,s,c-y,c+A,0,m),H=e(a,s,c+z,c+B,0,m),G&&(C=e(G,s,d-y,d+A,1,n),D=e(G,s,d+z,d+B,1,n)),H&&(E=e(H,s,d-y,d+A,1,n),F=e(H,s,d+z,d+B,1,n)),p>1&&console.timeEnd("clipping"),C&&j.push(C,b+1,2*c,2*d),D&&j.push(D,b+1,2*c,2*d+1),E&&j.push(E,b+1,2*c+1,2*d),F&&j.push(F,b+1,2*c+1,2*d+1)}}},h.prototype.getTile=function(a,b,c){var d=this.options,e=d.extent,f=d.debug,g=l(a,b,c);if(this.tiles[g])return i(this.tiles[g],e);f>1&&console.log("drilling down to z%d-%d-%d",a,b,c);for(var n,h=a,j=b,m=c;!n&&h>0;)h--,j=Math.floor(j/2),m=Math.floor(m/2),n=this.tiles[l(h,j,m)];if(f>1&&console.log("found parent tile z%d-%d-%d",h,j,m),n&&n.source){if(k(n.features,d.extent,d.buffer))return i(n,e);f>1&&console.time("drilling down"),this.splitTile(n.source,h,j,m,a,b,c),f>1&&console.timeEnd("drilling down")}return i(this.tiles[g],e)}},{"./clip":1,"./convert":2,"./tile":5}],4:[function(a,b,c){"use strict";function d(a,b){var i,j,k,l,c=b*b,d=a.length,f=0,g=d-1,h=[];for(a[f][2]=1,a[g][2]=1;g;){for(j=0,i=f+1;i<g;i++)(k=e(a[i],a[f],a[g]))>j&&(l=i,j=k);j>c?(a[l][2]=j,h.push(f),h.push(l),f=l):(g=h.pop(),f=h.pop())}}function e(a,b,c){var d=b[0],e=b[1],f=c[0],g=c[1],h=a[0],i=a[1],j=f-d,k=g-e;if(0!==j||0!==k){var l=((h-d)*j+(i-e)*k)/(j*j+k*k);l>1?(d=f,e=g):l>0&&(d+=j*l,e+=k*l)}return j=h-d,k=i-e,j*j+k*k}b.exports=d},{}],5:[function(a,b,c){"use strict";function d(a,b,c,d,f,g){for(var h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:c,y:d,z2:b,transformed:!1},i=0;i<a.length;i++)h.numFeatures++,e(h,a[i],f,g);return h}function e(a,b,c,d){var i,j,k,l,e=b.geometry,f=b.type,g=[],h=c*c;if(1===f)for(i=0;i<e.length;i++)g.push(e[i]),a.numPoints++,a.numSimplified++;else for(i=0;i<e.length;i++)if(k=e[i],d||!(2===f&&k.dist<c||3===f&&k.area<h)){var m=[];for(j=0;j<k.length;j++)l=k[j],(d||l[2]>h)&&(m.push(l),a.numSimplified++),a.numPoints++;g.push(m)}else a.numPoints+=k.length;g.length&&a.features.push({geometry:g,type:f,tags:b.tags||null})}b.exports=d},{}]},{},[3])(3)});
